
<html>
    <head>
        <script text="text/javascript" src="/camgaze.js/js/jsfeat.js"></script>
        <script text="text/javascript" src="/camgaze.js/js/compatibility.js"></script>
        <script text="text/javascript" src="/camgaze.js/js/camgaze.js"></script>
        <script text="text/javascript" src="/camgaze.js/cascades/eye.js"></script>
    </head>
    <body>
        <canvas id="mainCanvas"></canvas>
        <video style="display:none;" autoplay></video>
        <script text="text/javascript">
			window.onload = function () {
				var height = 480;
				var width = 640;

				var cGaze = new camgaze.Camgaze(
					width, 
					height, 
					"mainCanvas"
				);
				var eyeTracker = new camgaze.EyeTracker(width, height);
				var eyeFilter = new camgaze.EyeFilter();
                
				var frameOp = function (image_data, video, canvasDrawer) {
					var trackingData = eyeTracker.track(image_data, video);
					//console.log(trackingData);
					var gazeList = eyeFilter.getFilteredGaze(trackingData);
					//console.log(eyeFilter.getAverageLookingPoint(trackingData));
					if (trackingData.eyeList.length > 0) {
						gazeList.forEach(
							function (eye) {
								canvasDrawer.drawCircle(
									image_data,
									eye.centroid.unfiltered,
									5,  // radius
									-1, // line width (filled)
									"red"
								);
								/*
                                image_data = canvasDrawer.drawRectangle(
                                    image_data,
                                    eye.eyeData.getHaarRectangle(),
                                    eye.eyeData.getHaarRectangle().width,
                                    eye.eyeData.getHaarRectangle().height,
                                    5,
                                    "blue"
                                );

								// draws the gaze
								image_data = drawer.drawLine(
									image_data,
									eye.centroid.unfiltered,
									eye.centroid.unfiltered.add(eye.gazeVector),
									5,
									"green" 
								);

								// draws the pupil
								image_data = drawer.drawCircle(
									image_data,
									eye.centroid.unfiltered,
									5,  // radius
									-1, // line width (filled)
									"red"
								);
								*/
							}
						);
					}
					return image_data;
				};
				cGaze.setFrameOperator(frameOp);
			} 
		</script>
</html>

