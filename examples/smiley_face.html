<html>
<head>
	<title>Smiley Face Demo</title>
	<!-- Bootsrap -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Le Bootstrap styles -->
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">

	<!-- Le other styles -->
	<style>
		body {
			padding-top: 60px;
			padding-left: 30px;
			padding-right: 30px;
			background: lightgrey;
		}

	    video {
	      display:block;
	    }

	</style>
</head>
	<body>
		<!-- Navigation bar -->
		<div class="navbar navbar-fixed-top navbar-inverse">
	      <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="https://github.com/wallarelvo/camgaze.js">GitHub</a>
            </div>
	      </div>
	  </div>

	<div style="white-space: nowrap">
	    <canvas id="mainCanvas" style="display: inline-block;"></canvas>
	    <video autoplay style="display: inline-block;"></video>
	</div>

		<!-- JQuery and Bootstrap Javascript files -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>

		<!-- Concuss.js and Canvas utilities -->
		<script text="text/javascript" src="/js/jsfeat.js"></script>
		<script text="text/javascript" src="/js/compatibility.js"></script>
		<script text="text/javascript" src="/cascades/eye.js"></script>
		<script text="text/javascript" src="/cascades/frontalface.js"></script>
		<script text="text/javascript" src="/js/camgaze.js"></script>
		<script text="text/javascript">
			window.onload = function () {
				
				var cGaze = new camgaze.Camgaze(640, 480, "mainCanvas", true);
				var eyeTracker = new camgaze.EyeTracker(640, 480);
				var eyeFilter = new camgaze.EyeFilter();
				//var drawer = new camgaze.drawing.ImageDrawer();

				var frameOp = function (image_data, video, drawer) {
					var trackingData = eyeTracker.track(image_data, video);
					//console.log(trackingData);
					var gazeList = eyeFilter.getFilteredGaze(trackingData);
					//console.log(eyeFilter.getAverageLookingPoint(trackingData));
					if (trackingData.eyeList.length > 0) {
						drawer.clearAll();
						gazeList.forEach(
							function (eye) {
								// draws the face circle
								drawer.drawCircle(
									{
										x : (
											eye.eyeData.getFace().x + 
											eye.eyeData.getFace().width / 2
										),
										y : (
											eye.eyeData.getFace().y + 
											eye.eyeData.getFace().height / 2
										)
									},
									eye.eyeData.getFace().width / 2,
									2,
									"red"
								);

								// draws the first eye circle
								drawer.drawCircle(
									{
										x : (
											eye.eyeData.getFace().x + 
											eye.eyeData.getFace().width * 0.21 + 
											eye.eyeData.getHaarRectangle().width / 2
										),
										y : (
											eye.eyeData.getFace().y + 
											eye.eyeData.getFace().height * 0.37
										)
									},
									eye.eyeData.getHaarRectangle().width / 2.2,  // radius
									2, // line width (filled)
									"red"
								);

								// draws the second eye circle
								drawer.drawCircle(
									{
										x : (
											eye.eyeData.getFace().x + 
											eye.eyeData.getFace().width * 0.54 + 
											eye.eyeData.getHaarRectangle().width / 2
										),
										y : (
											eye.eyeData.getFace().y + 
											eye.eyeData.getFace().height * 0.37
										)
									},
									eye.eyeData.getHaarRectangle().width / 2.2,  // radius
									2, // line width (filled)
									"red"
								);

								// draws the first nose line
								drawer.drawLine(
									{
										x : (
											eye.eyeData.getFace().x + 
											eye.eyeData.getFace().width / 2 
										),

										y : (
											eye.eyeData.getFace().y + 
											eye.eyeData.getFace().height / 2 
										)
									},

									{
										x : (
											eye.eyeData.getFace().x + 20 +
											eye.eyeData.getFace().width / 2 
										),

										y : (
											eye.eyeData.getFace().y + 20 +
											eye.eyeData.getFace().height / 2 
										)
									},

									2,
									"red"
								);

								// draws horizontal nose line
								drawer.drawLine(
									{
										x : (
											eye.eyeData.getFace().x + 20 +
											eye.eyeData.getFace().width / 2 
										),

										y : (
											eye.eyeData.getFace().y + 20 +
											eye.eyeData.getFace().height / 2 
										)
									},

									{
										x : (
											eye.eyeData.getFace().x +
											eye.eyeData.getFace().width / 2 
										),

										y : (
											eye.eyeData.getFace().y + 20 +
											eye.eyeData.getFace().height / 2 
										)
									},

									2,
									"red"
								);

								// draws smile
								drawer.drawLine(
									{
										x : (
											eye.eyeData.getFace().x +
											eye.eyeData.getFace().width * 0.5
										),

										y : (
											eye.eyeData.getFace().y + 
											eye.eyeData.getFace().height * 0.7
										)
									},

									{
										x : (
											eye.eyeData.getFace().x +
											eye.eyeData.getFace().width * 0.4
										),

										y : (
											eye.eyeData.getFace().y +
											eye.eyeData.getFace().height * 0.6
										)
									},

									2,
									"red"
								);

								// draws smile
								drawer.drawLine(
									{
										x : (
											eye.eyeData.getFace().x +
											eye.eyeData.getFace().width * 0.5
										),

										y : (
											eye.eyeData.getFace().y + 
											eye.eyeData.getFace().height * 0.7
										)
									},

									{
										x : (
											eye.eyeData.getFace().x +
											eye.eyeData.getFace().width * 0.6
										),

										y : (
											eye.eyeData.getFace().y +
											eye.eyeData.getFace().height * 0.6
										)
									},

									2,
									"red"
								);

								// draws the gaze
								drawer.drawLine(
									eye.centroid.filtered,
									eye.centroid.filtered.add(eye.gazeVector),
									2,
									"green"
								);

								// draws the pupil
								drawer.drawCircle(
									eye.centroid.filtered,
									4,  // radius
									-1, // line width (filled)
									"red"
								);
							}
						);
					}
				};
				cGaze.setFrameOperator(frameOp);
			} 
		</script>
	</body>
</html>

